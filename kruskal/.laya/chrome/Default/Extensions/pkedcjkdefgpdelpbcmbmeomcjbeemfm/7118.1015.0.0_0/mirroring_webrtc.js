'use strict';var eka={TAB:0,Gj:1,en:2},Y$=function(a){yb("MediaRouter.WebRtc.Start.Success",a,eka)};var Z$=function(a,b){Hg.call(this,b);this.w=a;this.f=new zb;this.b=kw(b.id);this.j=new zb;this.A=!1;this.l=null;this.s=!1;this.o=this.h=null;fka(this);gka(this);this.b.sendMessage(new Ng("GET_TURN_CREDENTIALS"))};n(Z$,Hg);
Z$.prototype.start=function(a){var b=this;return this.f.b.then(function(c){if(c.f)return Promise.reject(new Kf("Mirroring already started"));if(b.l)return Promise.reject(new Kf("Session permanently stopped"));b.h=new ob("MediaRouter.WebRtc.Session.Launch");c.b.addStream(a);c.start();return b.j.b})};
Z$.prototype.stop=function(){var a=this;this.j.reject(new Kf("Session stop requested."));this.o&&(this.o.b(),this.o=null);if(this.l)return this.l;this.s=this.A=!1;this.h=null;return this.l=this.f.b.then(function(a){a.stop()}).then(function(){return a.b.Oa()}).catch(function(b){a.b.Oa();throw b;})};
var fka=function(a){a.b.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.f.resolve(new Sg(a.g.id,b.data.credentials));break;case "ANSWER":a.f.b.then(function(a){$g(a,b.data)});break;case "KNOCK_ANSWER":a.s=!0;a.f.b.then(function(a){$g(a,b.data)});break;case "STOP":a.j.reject(new Kf("Stop signal received"));a.stop();break;default:throw new Kf("Unknown message type: "+b.type);}}},gka=function(a){a.f.b.then(function(b){Wg(b,function(b){a.b.sendMessage(new Ng("OFFER",
new Pg(b,a.w,Qg)))});Xg(b,function(b){b=Og(b);a.b.sendMessage(b)});Tg(b,function(){a.A=!0;a.b.sendMessage(new Ng("SESSION_START_SUCCESS"));!a.s&&a.h&&a.h.b();a.h=null;a.o=new ub("MediaRouter.WebRtc.Session.Length");a.j.resolve(a)});Vg(b,function(){a.b.sendMessage(new Ng("SESSION_END"))});Ug(b,function(b){a.A||a.j.reject(b);a.b.sendMessage(new Ng("SESSION_FAILURE"))})})};var $$=function(){wg.call(this,"webrtc")};n($$,wg);g=$$.prototype;g.Wg=function(a,b){return new Z$(a,b)};g.wg=function(){Y$(0)};g.tg=function(){Y$(1)};g.Ch=function(){Y$(2)};g.ug=function(){xb("MediaRouter.WebRtc.Session.End")};g.Bh=function(a){yb("MediaRouter.WebRtc.Start.Failure",a,Jf)};g.vg=function(){xb("MediaRouter.WebRtc.Stream.End")};var hka=new $$;kg("mr.mirror.webrtc.WebRtcService",hka);
